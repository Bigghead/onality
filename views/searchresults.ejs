<% include partials/header %>
<% var keyword = keyword ; %>
<div class="container center-align">
  <h2 class="center orange-text">How People Feel About <%= keyword %></h2>
  <canvas id="myChart"></canvas>
</div>

<script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js'></script>

<script>

var emotionObj = <%- JSON.stringify(emotionObj) %>;
var labels = [];
var data = [];

for( var key in emotionObj){
  labels.push(key);
  data.push(emotionObj[key]);
}
var ctx = document.getElementById("myChart");
var myChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [{
      label: '# of Votes',
      data: data,
      backgroundColor: [
        'rgba(255, 99, 132, 0.2)',
        'rgba(54, 162, 235, 0.2)',
        'rgba(255, 206, 86, 0.2)',
        'rgba(75, 192, 192, 0.2)',
        'rgba(153, 102, 255, 0.2)',
        'rgba(255, 159, 64, 0.2)'
      ],
      borderColor: [
        'rgba(255,99,132,1)',
        'rgba(54, 162, 235, 1)',
        'rgba(255, 206, 86, 1)',
        'rgba(75, 192, 192, 1)',
        'rgba(153, 102, 255, 1)',
        'rgba(255, 159, 64, 1)'
      ],
      borderWidth: 1
    }]
  }
});
</script>

<script type="text/javascript">

var keyword = <%- JSON.stringify(keyword) %>;
console.log(keyword);
var data = [];
function loadXMLDoc(url) {
    var xmlhttp = new XMLHttpRequest();

    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
           if (xmlhttp.status == 200) {
             var newsData = JSON.parse(xmlhttp.responseText);
             console.log(newsData);
            //  console.log(newsData.articles);

            // newsData.articles.forEach(function(article){
            //    data.push(article);
            //  });
           }
           else if (xmlhttp.status == 400) {
              alert('There was an error 400');
           }
           else {
               alert('something else other than 200 was returned');
           }
        }
    };

    xmlhttp.open("GET", url, true);
    xmlhttp.send();
}
loadXMLDoc('https://gateway-a.watsonplatform.net/calls/data/GetNews?outputMode=json&start=now-1d&end=now&count=5&q.enriched.url.title='+ keyword +'&return=enriched.url.url,enriched.url.title,enriched.url.text&apikey=6c164f0588efeac988da699f5dbc55868d85a565');

</script>

<% include partials/footer %>
